<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BPMN Demo Integration</title>
  <style>
    body { font-family: Arial, sans-serif; display: flex; gap: 20px; }
    #editor, #viewer { border: 1px solid #ccc; width: 45%; height: 600px; }
    .buttons { margin: 10px 0; }
  </style>
  
  <!-- bpmn-js (Editor) -->
  <script src="https://unpkg.com/bpmn-js@11.5.0/dist/bpmn-modeler.development.js"></script>
  
  <!-- bpmn-visualization (Viewer) -->
  <script src="https://unpkg.com/bpmn-visualization@0.38.0/dist/bpmn-visualization.min.js"></script>
</head>
<body>

  <div style="flex:1">
    <h2>Design with bpmn-js</h2>
    <div id="editor"></div>
    <div class="buttons">
      <button id="export">Export XML</button>
      <button id="simulate">Simulate (Mock)</button>
    </div>
  </div>

  <div style="flex:1">
    <h2>View with bpmn-visualization</h2>
    <div id="viewer"></div>
  </div>

<script>
  // ---------- bpmn-js Editor ----------
  const bpmnModeler = new BpmnJS({ container: '#editor' });

  // Empty BPMN diagram template
  const initialDiagram = `<?xml version="1.0" encoding="UTF-8"?>
  <bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
    xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
    xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
    xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
    id="Definitions_1"
    targetNamespace="http://bpmn.io/schema/bpmn">
    <bpmn:process id="Process_1" isExecutable="false">
      <bpmn:startEvent id="StartEvent_1" name="Start"/>
    </bpmn:process>
    <bpmndi:BPMNDiagram id="BPMNDiagram_1">
      <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"/>
    </bpmndi:BPMNDiagram>
  </bpmn:definitions>`;

  bpmnModeler.importXML(initialDiagram);

  // ---------- bpmn-visualization Viewer ----------
  const bpmnVisu = new BpmnVisualization({ container: 'viewer' });

  // Store last exported XML
  let lastXML = initialDiagram;

  // Export XML button
  document.getElementById('export').addEventListener('click', async () => {
    const { xml } = await bpmnModeler.saveXML({ format: true });
    lastXML = xml;
    alert("XML Exported! Now click Simulate to view it.");
  });

  // Mock Simulation button
  document.getElementById('simulate').addEventListener('click', async () => {
    // Load exported XML into viewer
    bpmnVisu.load(lastXML);

    // Fake token path (pretend engine says we executed StartEvent_1)
    const registry = bpmnVisu.bpmnElementsRegistry;
    registry.addCssClasses('StartEvent_1', 'highlight');

    // You could add more highlights for tasks/gateways etc from engine data
  });

  // Highlight style
  const style = document.createElement('style');
  style.textContent = `
    .highlight > rect, .highlight > ellipse, .highlight > polygon {
      stroke: red !important;
      stroke-width: 4px !important;
    }
  `;
  document.head.appendChild(style);

</script>
</body>
</html>
