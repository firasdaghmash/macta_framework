<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MACTA-Flowable Process Builder</title>
    <style>
        :root {
            --primary-orange: #f39c12;
            --primary-red: #e74c3c;
            --primary-teal: #16a085;
            --primary-yellow: #f1c40f;
            --primary-green: #27ae60;
            --dark-gray: #2c3e50;
            --light-gray: #ecf0f1;
            --white: #ffffff;
            --flowable-blue: #1f77b4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-gray) 0%, #bdc3c7 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--flowable-blue) 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-info h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header-info p {
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .flowable-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-online { background: var(--primary-green); }
        .status-offline { background: var(--primary-red); }

        .container {
            display: flex;
            height: calc(100vh - 80px);
        }

        .toolbar {
            width: 280px;
            background: var(--white);
            border-right: 1px solid #ddd;
            padding: 1rem;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .toolbar h3 {
            color: var(--dark-gray);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 2px solid var(--primary-orange);
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tool-section {
            margin-bottom: 2rem;
        }

        .tool-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: var(--light-gray);
            border-radius: 8px;
            cursor: move;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .tool-item:hover {
            background: var(--primary-orange);
            color: white;
            transform: translateX(5px);
            border-color: var(--primary-orange);
        }

        .tool-item.flowable-certified::after {
            content: "‚úì";
            position: absolute;
            top: 2px;
            right: 5px;
            color: var(--primary-green);
            font-weight: bold;
            font-size: 0.8rem;
        }

        .tool-icon {
            font-size: 1.2rem;
            margin-right: 0.8rem;
            width: 25px;
            text-align: center;
        }

        .canvas-container {
            flex: 1;
            background: var(--white);
            position: relative;
            overflow: hidden;
        }

        .canvas-toolbar {
            background: rgba(255,255,255,0.95);
            padding: 0.8rem 1rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .canvas-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .canvas-btn:hover {
            background: var(--primary-orange);
            color: white;
            border-color: var(--primary-orange);
        }

        .canvas-btn.active {
            background: var(--flowable-blue);
            color: white;
            border-color: var(--flowable-blue);
        }

        .canvas {
            width: 100%;
            height: calc(100% - 60px);
            position: relative;
            background-image: 
                radial-gradient(circle, #ddd 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: auto;
        }

        .process-element {
            position: absolute;
            min-width: 120px;
            min-height: 60px;
            background: var(--white);
            border: 2px solid var(--primary-teal);
            border-radius: 8px;
            padding: 1rem;
            cursor: move;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .process-element:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }

        .process-element.selected {
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.3);
        }

        .process-element.flowable-deployed {
            border-color: var(--flowable-blue);
        }

        .process-element.flowable-deployed::before {
            content: "üöÄ";
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--flowable-blue);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .element-start {
            border-radius: 50%;
            width: 80px;
            height: 80px;
            background: var(--primary-green);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .element-end {
            border-radius: 50%;
            width: 80px;
            height: 80px;
            background: var(--primary-red);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .element-task {
            background: var(--primary-teal);
            color: white;
        }

        .element-gateway {
            transform: rotate(45deg);
            background: var(--primary-yellow);
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .element-gateway .content {
            transform: rotate(-45deg);
            font-weight: bold;
        }

        .properties-panel {
            width: 350px;
            background: var(--white);
            border-left: 1px solid #ddd;
            padding: 1rem;
            overflow-y: auto;
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
        }

        .properties-panel h3 {
            color: var(--dark-gray);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-teal);
            padding-bottom: 0.5rem;
        }

        .property-group {
            margin-bottom: 1.5rem;
        }

        .property-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .property-group input,
        .property-group textarea,
        .property-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .property-group input:focus,
        .property-group textarea:focus,
        .property-group select:focus {
            outline: none;
            border-color: var(--primary-teal);
            box-shadow: 0 0 0 2px rgba(22, 160, 133, 0.2);
        }

        .flowable-section {
            background: rgba(31, 119, 180, 0.05);
            border: 1px solid rgba(31, 119, 180, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .flowable-section h4 {
            color: var(--flowable-blue);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-orange);
            color: white;
        }

        .btn-primary:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .btn-flowable {
            background: var(--flowable-blue);
            color: white;
        }

        .btn-flowable:hover {
            background: #1a6ba3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--primary-teal);
            color: white;
        }

        .btn-secondary:hover {
            background: #138f75;
            transform: translateY(-2px);
        }

        .deployment-status {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            display: none;
        }

        .deployment-status.success {
            display: block;
        }

        .minimap {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            background: var(--white);
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .flowable-console {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 300px;
            height: 200px;
            background: rgba(0,0,0,0.9);
            color: #00ff00;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            overflow-y: auto;
            display: none;
        }

        .flowable-console.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .toolbar,
            .properties-panel {
                width: 100%;
                height: 200px;
            }
            
            .canvas-container {
                height: calc(100vh - 480px);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-info">
            <h1>üéØ MACTA-Flowable Process Builder</h1>
            <p>Enterprise-grade BPMN process design with Flowable engine integration</p>
        </div>
        <div class="flowable-status">
            <div class="status-indicator">
                <div class="status-dot status-online" id="flowable-status"></div>
                <span id="flowable-text">Flowable: Online</span>
            </div>
            <div class="status-indicator">
                <div class="status-dot status-online"></div>
                <span>MACTA: Ready</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="toolbar">
            <div class="tool-section">
                <h3>üéØ Start/End Events</h3>
                <div class="tool-item flowable-certified" draggable="true" data-type="start">
                    <span class="tool-icon">üü¢</span>
                    <span>Start Event</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="message-start">
                    <span class="tool-icon">üì®</span>
                    <span>Message Start</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="timer-start">
                    <span class="tool-icon">‚è∞</span>
                    <span>Timer Start</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="end">
                    <span class="tool-icon">üî¥</span>
                    <span>End Event</span>
                </div>
            </div>

            <div class="tool-section">
                <h3>üìã Tasks</h3>
                <div class="tool-item flowable-certified" draggable="true" data-type="user-task">
                    <span class="tool-icon">üë§</span>
                    <span>User Task</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="service-task">
                    <span class="tool-icon">‚öôÔ∏è</span>
                    <span>Service Task</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="script-task">
                    <span class="tool-icon">üìú</span>
                    <span>Script Task</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="manual-task">
                    <span class="tool-icon">‚úã</span>
                    <span>Manual Task</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="receive-task">
                    <span class="tool-icon">üì•</span>
                    <span>Receive Task</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="send-task">
                    <span class="tool-icon">üì§</span>
                    <span>Send Task</span>
                </div>
            </div>

            <div class="tool-section">
                <h3>üîÄ Gateways</h3>
                <div class="tool-item flowable-certified" draggable="true" data-type="exclusive-gateway">
                    <span class="tool-icon">‚óÜ</span>
                    <span>Exclusive Gateway</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="parallel-gateway">
                    <span class="tool-icon">‚ß¨</span>
                    <span>Parallel Gateway</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="inclusive-gateway">
                    <span class="tool-icon">‚óá</span>
                    <span>Inclusive Gateway</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="event-gateway">
                    <span class="tool-icon">‚¨ü</span>
                    <span>Event Gateway</span>
                </div>
            </div>

            <div class="tool-section">
                <h3>üîÑ Advanced</h3>
                <div class="tool-item flowable-certified" draggable="true" data-type="subprocess">
                    <span class="tool-icon">üì¶</span>
                    <span>Sub Process</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="call-activity">
                    <span class="tool-icon">üìû</span>
                    <span>Call Activity</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="boundary-timer">
                    <span class="tool-icon">‚è±Ô∏è</span>
                    <span>Boundary Timer</span>
                </div>
                <div class="tool-item flowable-certified" draggable="true" data-type="boundary-error">
                    <span class="tool-icon">‚ö†Ô∏è</span>
                    <span>Boundary Error</span>
                </div>
            </div>
        </div>

        <div class="canvas-container">
            <div class="canvas-toolbar">
                <button class="canvas-btn" onclick="toggleGrid()">
                    <span>üî≤</span> Grid
                </button>
                <button class="canvas-btn active" onclick="toggleSnap()">
                    <span>üß≤</span> Snap
                </button>
                <button class="canvas-btn" onclick="zoomIn()">
                    <span>üîç</span> Zoom In
                </button>
                <button class="canvas-btn" onclick="zoomOut()">
                    <span>üîç</span> Zoom Out
                </button>
                <button class="canvas-btn" onclick="autoLayout()">
                    <span>üìê</span> Auto Layout
                </button>
                <button class="canvas-btn" onclick="toggleConsole()">
                    <span>üíª</span> Console
                </button>
            </div>
            
            <div class="canvas" id="canvas">
                <!-- Process elements will be dynamically added here -->
            </div>
            
            <div class="minimap">
                <div style="padding: 10px; text-align: center; font-weight: bold; color: #666;">
                    Process Overview
                </div>
            </div>

            <div class="flowable-console" id="flowable-console">
                <div style="color: #00ff00; margin-bottom: 10px;">Flowable Engine Console</div>
                <div id="console-output">
                    Ready to deploy processes...<br>
                    Flowable REST API: http://localhost:8080/flowable-rest<br>
                    Engine Status: Online<br>
                </div>
            </div>
        </div>

        <div class="properties-panel">
            <h3>üîß Element Properties</h3>
            <div id="properties-content">
                <p style="color: #666; text-align: center; margin: 2rem 0;">
                    Select an element to edit its properties
                </p>
            </div>

            <div class="flowable-section">
                <h4>üöÄ Flowable Integration</h4>
                <div class="deployment-status" id="deployment-status">
                    <strong>‚úÖ Successfully deployed to Flowable!</strong><br>
                    Process Definition ID: <span id="process-def-id">-</span><br>
                    Version: <span id="process-version">-</span><br>
                    Deployment Time: <span id="deploy-time">-</span>
                </div>
                
                <button class="btn btn-flowable" onclick="deployToFlowable()" style="width: 100%; margin-bottom: 0.5rem;">
                    üöÄ Deploy to Engine
                </button>
                
                <button class="btn btn-secondary" onclick="startProcessInstance()" style="width: 100%; margin-bottom: 0.5rem;">
                    ‚ñ∂Ô∏è Start Instance
                </button>
                
                <button class="btn btn-primary" onclick="viewFlowableAdmin()" style="width: 100%;">
                    üéõÔ∏è Flowable Admin
                </button>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveProcess()">üíæ Save Process</button>
                <button class="btn btn-secondary" onclick="exportBPMN()">üì§ Export BPMN</button>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="validateProcess()">‚úÖ Validate</button>
                <button class="btn btn-primary" onclick="simulateProcess()">üé¨ Simulate</button>
            </div>
        </div>
    </div>

    <script>
        let selectedElement = null;
        let elementCounter = 0;
        let processElements = [];
        let connections = [];
        let flowableEngine = {
            connected: false,
            processDefinitionId: null,
            deploymentId: null
        };

        // Initialize Flowable connection check
        window.addEventListener('load', () => {
            checkFlowableConnection();
            setTimeout(() => {
                if (processElements.length === 0) {
                    addToConsole('üéØ MACTA-Flowable Process Builder loaded successfully!');
                    addToConsole('üìã Drag elements from toolbar to canvas to start building your process');
                    addToConsole('üöÄ All elements are Flowable-certified and ready for deployment');
                }
            }, 1000);
        });

        // Check Flowable engine connection
        async function checkFlowableConnection() {
            try {
                // In real implementation, this would check actual Flowable REST API
                // For demo purposes, we'll simulate the connection
                const response = await simulateFlowableAPI('/repository/deployments', 'GET');
                
                if (response.ok) {
                    flowableEngine.connected = true;
                    document.getElementById('flowable-status').className = 'status-dot status-online';
                    document.getElementById('flowable-text').textContent = 'Flowable: Online';
                    addToConsole('‚úÖ Connected to Flowable engine at localhost:8080');
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                flowableEngine.connected = false;
                document.getElementById('flowable-status').className = 'status-dot status-offline';
                document.getElementById('flowable-text').textContent = 'Flowable: Offline';
                addToConsole('‚ùå Flowable engine connection failed');
                addToConsole('üí° Start Flowable engine: java -jar flowable-rest.war');
            }
        }

        // Simulate Flowable API calls for demo
        async function simulateFlowableAPI(endpoint, method, data = null) {
            addToConsole(`üåê API Call: ${method} ${endpoint}`);
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Simulate successful responses
            return {
                ok: true,
                json: () => Promise.resolve({
                    id: `process_${Date.now()}`,
                    version: 1,
                    deploymentTime: new Date().toISOString()
                })
            };
        }

        // Console functionality
        function addToConsole(message) {
            const console = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function toggleConsole() {
            const console = document.getElementById('flowable-console');
            console.classList.toggle('active');
        }

        // Canvas toolbar functions
        function toggleGrid() {
            const canvas = document.getElementById('canvas');
            const currentBg = canvas.style.backgroundImage;
            if (currentBg.includes('radial-gradient')) {
                canvas.style.backgroundImage = 'none';
            } else {
                canvas.style.backgroundImage = 'radial-gradient(circle, #ddd 1px, transparent 1px)';
            }
        }

        function toggleSnap() {
            // Implementation for snap-to-grid functionality
            addToConsole('üß≤ Snap-to-grid toggled');
        }

        function zoomIn() {
            const canvas = document.getElementById('canvas');
            const currentScale = canvas.style.transform.match(/scale\(([^)]+)\)/);
            const scale = currentScale ? parseFloat(currentScale[1]) * 1.1 : 1.1;
            canvas.style.transform = `scale(${Math.min(scale, 3)})`;
            addToConsole(`üîç Zoom: ${Math.round(scale * 100)}%`);
        }

        function zoomOut() {
            const canvas = document.getElementById('canvas');
            const currentScale = canvas.style.transform.match(/scale\(([^)]+)\)/);
            const scale = currentScale ? parseFloat(currentScale[1]) * 0.9 : 0.9;
            canvas.style.transform = `scale(${Math.max(scale, 0.3)})`;
            addToConsole(`üîç Zoom: ${Math.round(scale * 100)}%`);
        }

        function autoLayout() {
            addToConsole('üìê Auto-layout algorithm applied');
            // Implementation for automatic layout
        }

        // Drag and Drop Functionality
        document.querySelectorAll('.tool-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', item.dataset.type);
            });
        });

        const canvas = document.getElementById('canvas');
        canvas.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        canvas.addEventListener('drop', (e) => {
            e.preventDefault();
            const elementType = e.dataTransfer.getData('text/plain');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            createElement(elementType, x, y);
            addToConsole(`‚ûï Added ${elementType} element to canvas`);
        });

        function createElement(type, x, y) {
            elementCounter++;
            const elementId = `element_${elementCounter}`;
            
            const element = document.createElement('div');
            element.className = 'process-element';
            element.id = elementId;
            element.style.left = `${x}px`;
            element.style.top = `${y}px`;
            
            // Set element-specific styles and content
            switch (type) {
                case 'start':
                    element.className += ' element-start';
                    element.innerHTML = '‚ñ∂Ô∏è';
                    break;
                case 'message-start':
                    element.className += ' element-start';
                    element.innerHTML = 'üì®';
                    break;
                case 'timer-start':
                    element.className += ' element-start';
                    element.innerHTML = '‚è∞';
                    break;
                case 'end':
                    element.className += ' element-end';
                    element.innerHTML = '‚èπÔ∏è';
                    break;
                case 'user-task':
                    element.className += ' element-task';
                    element.innerHTML = '<div>üë§ User Task</div>';
                    break;
                case 'service-task':
                    element.className += ' element-task';
                    element.innerHTML = '<div>‚öôÔ∏è Service Task</div>';
                    break;
                case 'script-task':
                    element.className += ' element-task';
                    element.innerHTML = '<div>üìú Script Task</div>';
                    break;
                case 'manual-task':
                    element.className += ' element-task';
                    element.innerHTML = '<div>‚úã Manual Task</div>';
                    break;
                case 'receive-task':
                    element.className += ' element-task';
                    element.innerHTML = '<div>üì• Receive Task</div>';
                    break;
                case 'send-task':
                    element.className += ' element-task';
                    element.innerHTML = '<div>üì§ Send Task</div>';
                    break;
                case 'exclusive-gateway':
                    element.className += ' element-gateway';
                    element.innerHTML = '<div class="content">X</div>';
                    break;
                case 'parallel-gateway':
                    element.className += ' element-gateway';
                    element.innerHTML = '<div class="content">+</div>';
                    break;
                case 'inclusive-gateway':
                    element.className += ' element-gateway';
                    element.innerHTML = '<div class="content">O</div>';
                    break;
                case 'event-gateway':
                    element.className += ' element-gateway';
                    element.innerHTML = '<div class="content">‚¨ü</div>';
                    break;
                case 'subprocess':
                    element.innerHTML = '<div>üì¶ Sub Process</div>';
                    break;
                case 'call-activity':
                    element.innerHTML = '<div>üìû Call Activity</div>';
                    break;
                case 'boundary-timer':
                    element.innerHTML = '<div>‚è±Ô∏è Timer</div>';
                    element.style.width = '40px';
                    element.style.height = '40px';
                    break;
                case 'boundary-error':
                    element.innerHTML = '<div>‚ö†Ô∏è Error</div>';
                    element.style.width = '40px';
                    element.style.height = '40px';
                    break;
            }
            
            // Add event listeners
            element.addEventListener('click', () => selectElement(element, type));
            element.addEventListener('mousedown', startDrag);
            
            canvas.appendChild(element);
            
            // Store element data with Flowable-specific properties
            processElements.push({
                id: elementId,
                type: type,
                x: x,
                y: y,
                properties: {
                    name: `${type.replace('-', ' ')} ${elementCounter}`,
                    description: '',
                    assignee: '',
                    candidateGroups: '',
                    duration: '',
                    condition: '',
                    flowableExpression: '',
                    formKey: '',
                    priority: '50',
                    documentation: ''
                }
            });
        }

        function selectElement(element, type) {
            // Remove previous selection
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            
            // Select new element
            selectedElement = element;
            element.classList.add('selected');
            
            // Show properties
            showProperties(element.id, type);
            addToConsole(`üéØ Selected ${type} element`);
        }

        function showProperties(elementId, type) {
            const elementData = processElements.find(el => el.id === elementId);
            const propertiesContent = document.getElementById('properties-content');
            
            let flowableSpecificProps = '';
            
            // Add Flowable-specific properties based on element type
            if (type.includes('task')) {
                flowableSpecificProps = `
                <div class="property-group">
                    <label>Assignee (Flowable):</label>
                    <input type="text" id="prop-assignee" value="${elementData.properties.assignee}" 
                           onchange="updateProperty('assignee', this.value)" 
                           placeholder="john.doe or ${user.email}">
                </div>
                
                <div class="property-group">
                    <label>Candidate Groups:</label>
                    <input type="text" id="prop-candidateGroups" value="${elementData.properties.candidateGroups}" 
                           onchange="updateProperty('candidateGroups', this.value)" 
                           placeholder="managers, analysts">
                </div>
                
                <div class="property-group">
                    <label>Form Key:</label>
                    <input type="text" id="prop-formKey" value="${elementData.properties.formKey}" 
                           onchange="updateProperty('formKey', this.value)" 
                           placeholder="approvalForm.form">
                </div>
                
                <div class="property-group">
                    <label>Priority (0-100):</label>
                    <input type="number" id="prop-priority" value="${elementData.properties.priority}" 
                           onchange="updateProperty('priority', this.value)" min="0" max="100">
                </div>
                `;
            }
            
            if (type.includes('gateway')) {
                flowableSpecificProps = `
                <div class="property-group">
                    <label>Condition Expression:</label>
                    <textarea id="prop-condition" rows="2" onchange="updateProperty('condition', this.value)" 
                              placeholder="\${amount > 1000}">${elementData.properties.condition}</textarea>
                </div>
                
                <div class="property-group">
                    <label>Flowable Expression:</label>
                    <textarea id="prop-flowableExpression" rows="2" onchange="updateProperty('flowableExpression', this.value)" 
                              placeholder="\${approvalService.isApprovalRequired(amount)}">${elementData.properties.flowableExpression}</textarea>
                </div>
                `;
            }

            propertiesContent.innerHTML = `
                <div class="property-group">
                    <label>Element Name:</label>
                    <input type="text" id="prop-name" value="${elementData.properties.name}" onchange="updateProperty('name', this.value)">
                </div>
                
                <div class="property-group">
                    <label>Description:</label>
                    <textarea id="prop-description" rows="3" onchange="updateProperty('description', this.value)">${elementData.properties.description}</textarea>
                </div>
                
                <div class="property-group">
                    <label>Documentation:</label>
                    <textarea id="prop-documentation" rows="2" onchange="updateProperty('documentation', this.value)" 
                              placeholder="Technical documentation for this element">${elementData.properties.documentation}</textarea>
                </div>
                
                ${flowableSpecificProps}
                
                <div class="property-group">
                    <label>Element Type:</label>
                    <input type="text" value="${type}" readonly style="background: #f5f5f5;">
                </div>
                
                <div class="property-group">
                    <label>Element ID:</label>
                    <input type="text" value="${elementId}" readonly style="background: #f5f5f5;">
                </div>
            `;
        }

        function updateProperty(property, value) {
            if (selectedElement) {
                const elementData = processElements.find(el => el.id === selectedElement.id);
                elementData.properties[property] = value;
                
                // Update element display if it's the name
                if (property === 'name' && !selectedElement.classList.contains('element-start') && !selectedElement.classList.contains('element-end')) {
                    const content = selectedElement.querySelector('div') || selectedElement;
                    if (selectedElement.classList.contains('element-gateway')) {
                        // Don't change gateway symbols
                    } else {
                        const icon = content.innerHTML.split(' ')[0];
                        content.innerHTML = `${icon} ${value}`;
                    }
                }
                
                addToConsole(`üîß Updated ${property}: ${value}`);
            }
        }

        // Drag functionality for elements on canvas
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        function startDrag(e) {
            isDragging = true;
            const rect = e.target.getBoundingClientRect();
            const canvasRect = canvas.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }

        function drag(e) {
            if (!isDragging || !selectedElement) return;
            
            const canvasRect = canvas.getBoundingClientRect();
            const x = e.clientX - canvasRect.left - dragOffset.x;
            const y = e.clientY - canvasRect.top - dragOffset.y;
            
            selectedElement.style.left = `${x}px`;
            selectedElement.style.top = `${y}px`;
            
            // Update element data
            const elementData = processElements.find(el => el.id === selectedElement.id);
            elementData.x = x;
            elementData.y = y;
        }

        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Flowable-specific functions
        async function deployToFlowable() {
            if (!flowableEngine.connected) {
                addToConsole('‚ùå Cannot deploy: Flowable engine is offline');
                alert('Flowable engine is not connected. Please check your Flowable installation.');
                return;
            }

            if (processElements.length === 0) {
                addToConsole('‚ùå Cannot deploy: No process elements found');
                alert('Please add some elements to your process before deploying.');
                return;
            }

            addToConsole('üöÄ Starting deployment to Flowable engine...');
            
            try {
                // Generate BPMN XML
                const bpmnXml = generateFlowableBPMN();
                addToConsole('üìÑ Generated Flowable BPMN XML');
                
                // Deploy to Flowable (simulated)
                const deploymentResponse = await simulateFlowableAPI('/repository/deployments', 'POST', {
                    name: `MACTA_Process_${Date.now()}`,
                    source: bpmnXml
                });
                
                if (deploymentResponse.ok) {
                    const deploymentData = await deploymentResponse.json();
                    
                    flowableEngine.processDefinitionId = deploymentData.id;
                    flowableEngine.deploymentId = deploymentData.id;
                    
                    // Update UI
                    document.getElementById('deployment-status').classList.add('success');
                    document.getElementById('process-def-id').textContent = deploymentData.id;
                    document.getElementById('process-version').textContent = deploymentData.version;
                    document.getElementById('deploy-time').textContent = new Date(deploymentData.deploymentTime).toLocaleString();
                    
                    // Mark all elements as deployed
                    processElements.forEach(element => {
                        const elementEl = document.getElementById(element.id);
                        if (elementEl) {
                            elementEl.classList.add('flowable-deployed');
                        }
                    });
                    
                    addToConsole('‚úÖ Process successfully deployed to Flowable!');
                    addToConsole(`üìã Process Definition ID: ${deploymentData.id}`);
                    addToConsole(`üî¢ Version: ${deploymentData.version}`);
                    
                } else {
                    throw new Error('Deployment failed');
                }
                
            } catch (error) {
                addToConsole('‚ùå Deployment failed: ' + error.message);
                alert('Deployment failed. Check console for details.');
            }
        }

        async function startProcessInstance() {
            if (!flowableEngine.processDefinitionId) {
                addToConsole('‚ùå Cannot start instance: Process not deployed');
                alert('Please deploy the process first before starting an instance.');
                return;
            }

            addToConsole('‚ñ∂Ô∏è Starting new process instance...');
            
            try {
                const instanceResponse = await simulateFlowableAPI('/runtime/process-instances', 'POST', {
                    processDefinitionId: flowableEngine.processDefinitionId,
                    variables: {
                        initiatedBy: 'MACTA_Framework',
                        startTime: new Date().toISOString()
                    }
                });
                
                if (instanceResponse.ok) {
                    const instanceData = await instanceResponse.json();
                    addToConsole(`‚úÖ Process instance started: ${instanceData.id}`);
                    addToConsole('üéØ Instance is now running in Flowable engine');
                    alert(`Process instance started successfully!\n\nInstance ID: ${instanceData.id}\n\nYou can monitor this instance in the Flowable Admin interface.`);
                } else {
                    throw new Error('Failed to start instance');
                }
                
            } catch (error) {
                addToConsole('‚ùå Failed to start instance: ' + error.message);
                alert('Failed to start process instance. Check console for details.');
            }
        }

        function viewFlowableAdmin() {
            addToConsole('üéõÔ∏è Opening Flowable Admin interface...');
            // In real implementation, this would open Flowable Admin
            window.open('http://localhost:8080/flowable-admin', '_blank');
        }

        function generateFlowableBPMN() {
            const processId = `macta_process_${Date.now()}`;
            const processName = `MACTA Process - ${new Date().toLocaleDateString()}`;
            
            let bpmnXml = `<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/bpmn"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
             targetNamespace="http://macta.htt.com/processes"
             exporter="MACTA Framework"
             exporterVersion="1.0">
  
  <process id="${processId}" name="${processName}" isExecutable="true">
`;

            // Add process elements with Flowable-specific attributes
            processElements.forEach(element => {
                const props = element.properties;
                
                switch (element.type) {
                    case 'start':
                        bpmnXml += `    <startEvent id="${element.id}" name="${props.name}">\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </startEvent>\n`;
                        break;
                        
                    case 'message-start':
                        bpmnXml += `    <startEvent id="${element.id}" name="${props.name}">\n`;
                        bpmnXml += `      <messageEventDefinition />\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </startEvent>\n`;
                        break;
                        
                    case 'timer-start':
                        bpmnXml += `    <startEvent id="${element.id}" name="${props.name}">\n`;
                        bpmnXml += `      <timerEventDefinition>\n`;
                        bpmnXml += `        <timeCycle>R/PT1H</timeCycle>\n`;
                        bpmnXml += `      </timerEventDefinition>\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </startEvent>\n`;
                        break;
                        
                    case 'end':
                        bpmnXml += `    <endEvent id="${element.id}" name="${props.name}">\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </endEvent>\n`;
                        break;
                        
                    case 'user-task':
                        bpmnXml += `    <userTask id="${element.id}" name="${props.name}"`;
                        if (props.assignee) bpmnXml += ` flowable:assignee="${props.assignee}"`;
                        if (props.candidateGroups) bpmnXml += ` flowable:candidateGroups="${props.candidateGroups}"`;
                        if (props.formKey) bpmnXml += ` flowable:formKey="${props.formKey}"`;
                        if (props.priority) bpmnXml += ` flowable:priority="${props.priority}"`;
                        bpmnXml += `>\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </userTask>\n`;
                        break;
                        
                    case 'service-task':
                        bpmnXml += `    <serviceTask id="${element.id}" name="${props.name}" flowable:class="org.flowable.engine.impl.bpmn.behavior.NoneActivityBehavior">\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </serviceTask>\n`;
                        break;
                        
                    case 'script-task':
                        bpmnXml += `    <scriptTask id="${element.id}" name="${props.name}" scriptFormat="javascript">\n`;
                        bpmnXml += `      <script>// Add your script here</script>\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </scriptTask>\n`;
                        break;
                        
                    case 'exclusive-gateway':
                        bpmnXml += `    <exclusiveGateway id="${element.id}" name="${props.name}">\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </exclusiveGateway>\n`;
                        break;
                        
                    case 'parallel-gateway':
                        bpmnXml += `    <parallelGateway id="${element.id}" name="${props.name}">\n`;
                        if (props.documentation) {
                            bpmnXml += `      <documentation>${props.documentation}</documentation>\n`;
                        }
                        bpmnXml += `    </parallelGateway>\n`;
                        break;
                }
            });

            // Add basic diagram information
            bpmnXml += `  </process>
  
  <bpmndi:BPMNDiagram id="BPMNDiagram_${processId}">
    <bpmndi:BPMNPlane id="BPMNPlane_${processId}" bpmnElement="${processId}">
`;

            // Add shape information for each element
            processElements.forEach(element => {
                bpmnXml += `      <bpmndi:BPMNShape id="BPMNShape_${element.id}" bpmnElement="${element.id}">
        <omgdc:Bounds x="${element.x}" y="${element.y}" width="120" height="80" />
      </bpmndi:BPMNShape>
`;
            });

            bpmnXml += `    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>`;

            return bpmnXml;
        }

        // Action functions
        function saveProcess() {
            const processData = {
                elements: processElements,
                connections: connections,
                flowableData: {
                    processDefinitionId: flowableEngine.processDefinitionId,
                    deploymentId: flowableEngine.deploymentId,
                    deployed: flowableEngine.processDefinitionId !== null
                },
                timestamp: new Date().toISOString()
            };
            
            addToConsole('üíæ Saving process to MACTA database...');
            // In a real implementation, this would save to your MACTA database
            console.log('Saving process:', processData);
            alert('Process saved successfully!\n\nIn the full implementation, this will save to your MACTA framework database with Flowable integration data.');
        }

        function exportBPMN() {
            const bpmnXml = generateFlowableBPMN();
            
            // Download the BPMN file
            const blob = new Blob([bpmnXml], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `macta_flowable_process_${Date.now()}.bpmn`;
            a.click();
            URL.revokeObjectURL(url);
            
            addToConsole('üì§ BPMN file exported successfully');
        }

        function validateProcess() {
            let errors = [];
            let warnings = [];
            
            // Check for start event
            const startEvents = processElements.filter(el => el.type.includes('start'));
            if (startEvents.length === 0) {
                errors.push('Process must have at least one start event');
            }
            
            // Check for end event
            const endEvents = processElements.filter(el => el.type.includes('end'));
            if (endEvents.length === 0) {
                errors.push('Process must have at least one end event');
            }
            
            // Check for element names
            processElements.forEach(el => {
                if (!el.properties.name.trim()) {
                    errors.push(`Element ${el.id} is missing a name`);
                }
                
                // Flowable-specific validations
                if (el.type === 'user-task') {
                    if (!el.properties.assignee && !el.properties.candidateGroups) {
                        warnings.push(`User task ${el.properties.name} has no assignee or candidate groups`);
                    }
                }
                
                if (el.type.includes('gateway')) {
                    if (!el.properties.condition && !el.properties.flowableExpression) {
                        warnings.push(`Gateway ${el.properties.name} has no condition defined`);
                    }
                }
            });
            
            addToConsole('‚úÖ Process validation completed');
            
            let message = '';
            if (errors.length === 0 && warnings.length === 0) {
                message = '‚úÖ Process validation successful!\n\nYour process is ready for Flowable deployment.';
                addToConsole('üéØ No validation errors found');
            } else {
                message = '‚ö†Ô∏è Process validation completed with issues:\n\n';
                
                if (errors.length > 0) {
                    message += 'ERRORS:\n' + errors.join('\n') + '\n\n';
                    addToConsole(`‚ùå Found ${errors.length} validation errors`);
                }
                
                if (warnings.length > 0) {
                    message += 'WARNINGS:\n' + warnings.join('\n');
                    addToConsole(`‚ö†Ô∏è Found ${warnings.length} validation warnings`);
                }
            }
            
            alert(message);
        }

        function simulateProcess() {
            if (processElements.length === 0) {
                alert('Please add some elements to simulate the process.');
                return;
            }
            
            addToConsole('üé¨ Starting process simulation...');
            
            // Simulate process execution with Flowable
            setTimeout(() => {
                addToConsole('‚ö° Simulation running in Flowable engine...');
                
                setTimeout(() => {
                    addToConsole('üìä Simulation completed successfully');
                    
                    const simulationResults = {
                        totalTime: Math.floor(Math.random() * 300) + 60, // 60-360 seconds
                        tasksExecuted: processElements.filter(el => el.type.includes('task')).length,
                        gatewaysPassed: processElements.filter(el => el.type.includes('gateway')).length,
                        avgWaitTime: Math.floor(Math.random() * 60) + 5 // 5-65 seconds
                    };
                    
                    alert(`üé¨ Process simulation completed!\n\nüìä Results:\n‚Ä¢ Total execution time: ${simulationResults.totalTime} seconds\n‚Ä¢ Tasks executed: ${simulationResults.tasksExecuted}\n‚Ä¢ Gateways passed: ${simulationResults.gatewaysPassed}\n‚Ä¢ Average wait time: ${simulationResults.avgWaitTime} seconds\n\nüöÄ In the full MACTA implementation, this will:\n‚Ä¢ Run the process through the Flowable engine\n‚Ä¢ Show real-time execution visualization\n‚Ä¢ Display detailed timing and resource metrics\n‚Ä¢ Generate performance reports\n‚Ä¢ Integrate with your MACTA analytics module`);
                }, 2000);
            }, 1000);
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        saveProcess();
                        break;
                    case 'd':
                        e.preventDefault();
                        deployToFlowable();
                        break;
                    case 'r':
                        e.preventDefault();
                        startProcessInstance();
                        break;
                    case '`':
                        e.preventDefault();
                        toggleConsole();
                        break;
                }
            }
            
            if (e.key === 'Delete' && selectedElement) {
                // Delete selected element
                selectedElement.remove();
                processElements = processElements.filter(el => el.id !== selectedElement.id);
                selectedElement = null;
                document.getElementById('properties-content').innerHTML = '<p style="color: #666; text-align: center; margin: 2rem 0;">Select an element to edit its properties</p>';
                addToConsole('üóëÔ∏è Element deleted');
            }
        });

        // Add context menu for elements
        canvas.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            
            if (selectedElement) {
                const contextMenu = `
                    <div style="position: fixed; top: ${e.clientY}px; left: ${e.clientX}px; 
                                background: white; border: 1px solid #ddd; border-radius: 4px; 
                                box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 10000; padding: 0.5rem;">
                        <div onclick="duplicateElement()" style="padding: 0.5rem; cursor: pointer; hover: background: #f5f5f5;">üìã Duplicate</div>
                        <div onclick="deleteElement()" style="padding: 0.5rem; cursor: pointer; hover: background: #f5f5f5;">üóëÔ∏è Delete</div>
                        <div onclick="showElementCode()" style="padding: 0.5rem; cursor: pointer; hover: background: #f5f5f5;">üìÑ View BPMN</div>
                    </div>
                `;
                
                // Remove existing context menu
                const existingMenu = document.querySelector('.context-menu');
                if (existingMenu) existingMenu.remove();
                
                // Add new context menu
                const menuDiv = document.createElement('div');
                menuDiv.className = 'context-menu';
                menuDiv.innerHTML = contextMenu;
                document.body.appendChild(menuDiv);
                
                // Remove menu when clicking elsewhere
                setTimeout(() => {
                    document.addEventListener('click', () => {
                        const menu = document.querySelector('.context-menu');
                        if (menu) menu.remove();
                    }, { once: true });
                }, 10);
            }
        });

        function duplicateElement() {
            if (selectedElement) {
                const elementData = processElements.find(el => el.id === selectedElement.id);
                createElement(elementData.type, elementData.x + 50, elementData.y + 50);
                addToConsole('üìã Element duplicated');
            }
        }

        function deleteElement() {
            if (selectedElement) {
                selectedElement.remove();
                processElements = processElements.filter(el => el.id !== selectedElement.id);
                selectedElement = null;
                document.getElementById('properties-content').innerHTML = '<p style="color: #666; text-align: center; margin: 2rem 0;">Select an element to edit its properties</p>';
                addToConsole('üóëÔ∏è Element deleted');
            }
        }

        function showElementCode() {
            if (selectedElement) {
                const elementData = processElements.find(el => el.id === selectedElement.id);
                
                // Generate BPMN snippet for this element
                let bpmnSnippet = '';
                const props = elementData.properties;
                
                switch (elementData.type) {
                    case 'user-task':
                        bpmnSnippet = `<userTask id="${elementData.id}" name="${props.name}"`;
                        if (props.assignee) bpmnSnippet += `\n         flowable:assignee="${props.assignee}"`;
                        if (props.candidateGroups) bpmnSnippet += `\n         flowable:candidateGroups="${props.candidateGroups}"`;
                        if (props.formKey) bpmnSnippet += `\n         flowable:formKey="${props.formKey}"`;
                        bpmnSnippet += ' />';
                        break;
                    case 'service-task':
                        bpmnSnippet = `<serviceTask id="${elementData.id}" name="${props.name}"\n             flowable:class="org.flowable.engine.impl.bpmn.behavior.NoneActivityBehavior" />`;
                        break;
                    default:
                        bpmnSnippet = `<${elementData.type.replace('-', '')} id="${elementData.id}" name="${props.name}" />`;
                }
                
                alert(`üìÑ BPMN Code for ${props.name}:\n\n${bpmnSnippet}`);
                addToConsole('üìÑ Displayed BPMN code for selected element');
            }
        }

        // Auto-save functionality
        setInterval(() => {
            if (processElements.length > 0) {
                localStorage.setItem('macta_flowable_process', JSON.stringify({
                    elements: processElements,
                    connections: connections,
                    timestamp: new Date().toISOString()
                }));
                addToConsole('üíæ Auto-saved process to local storage');
            }
        }, 30000); // Auto-save every 30 seconds

        // Load saved process on startup
        window.addEventListener('load', () => {
            const savedProcess = localStorage.getItem('macta_flowable_process');
            if (savedProcess) {
                try {
                    const processData = JSON.parse(savedProcess);
                    if (processData.elements && processData.elements.length > 0) {
                        const shouldLoad = confirm('Found a previously saved process. Would you like to load it?');
                        if (shouldLoad) {
                            loadProcess(processData);
                            addToConsole('üìÇ Loaded previously saved process');
                        }
                    }
                } catch (error) {
                    addToConsole('‚ùå Error loading saved process: ' + error.message);
                }
            }
        });

        function loadProcess(processData) {
            // Clear current process
            processElements = [];
            connections = [];
            canvas.innerHTML = '';
            elementCounter = 0;

            // Load elements
            processData.elements.forEach(elementData => {
                createElement(elementData.type, elementData.x, elementData.y);
                
                // Update properties
                const newElement = processElements[processElements.length - 1];
                newElement.properties = { ...elementData.properties };
            });
        }

        // Add tooltips for toolbar items
        document.querySelectorAll('.tool-item').forEach(item => {
            item.addEventListener('mouseenter', (e) => {
                const tooltip = document.createElement('div');
                tooltip.style.cssText = `
                    position: fixed;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 0.5rem;
                    border-radius: 4px;
                    font-size: 0.8rem;
                    z-index: 10000;
                    pointer-events: none;
                `;
                
                const type = item.dataset.type;
                const descriptions = {
                    'start': 'Drag to canvas to create a process start event',
                    'user-task': 'Creates a task that requires human interaction',
                    'service-task': 'Automated task executed by the system',
                    'exclusive-gateway': 'Decision point with single outgoing path',
                    'parallel-gateway': 'Split or join parallel execution paths'
                };
                
                tooltip.textContent = descriptions[type] || `Flowable-certified ${type.replace('-', ' ')} element`;
                tooltip.style.left = e.clientX + 10 + 'px';
                tooltip.style.top = e.clientY - 30 + 'px';
                
                document.body.appendChild(tooltip);
                item._tooltip = tooltip;
            });
            
            item.addEventListener('mouseleave', () => {
                if (item._tooltip) {
                    item._tooltip.remove();
                    item._tooltip = null;
                }
            });
        });

        // Performance monitoring
        let performanceMetrics = {
            elementsCreated: 0,
            deploymentsAttempted: 0,
            validationsRun: 0,
            simulationsRun: 0
        };

        function updateMetrics(action) {
            performanceMetrics[action]++;
            addToConsole(`üìä Metrics updated: ${action} = ${performanceMetrics[action]}`);
        }

        // Override existing functions to track metrics
        const originalCreateElement = createElement;
        createElement = function(...args) {
            updateMetrics('elementsCreated');
            return originalCreateElement.apply(this, args);
        };

        const originalDeployToFlowable = deployToFlowable;
        deployToFlowable = function(...args) {
            updateMetrics('deploymentsAttempted');
            return originalDeployToFlowable.apply(this, args);
        };

        const originalValidateProcess = validateProcess;
        validateProcess = function(...args) {
            updateMetrics('validationsRun');
            return originalValidateProcess.apply(this, args);
        };

        const originalSimulateProcess = simulateProcess;
        simulateProcess = function(...args) {
            updateMetrics('simulationsRun');
            return originalSimulateProcess.apply(this, args);
        };

        // Add help system
        function showHelp() {
            const helpContent = `
üéØ MACTA-Flowable Process Builder Help

üñ±Ô∏è BASIC OPERATIONS:
‚Ä¢ Drag elements from toolbar to canvas
‚Ä¢ Click elements to select and edit properties
‚Ä¢ Right-click for context menu (duplicate, delete, view code)
‚Ä¢ Delete key to remove selected element

‚å®Ô∏è KEYBOARD SHORTCUTS:
‚Ä¢ Ctrl+S: Save process
‚Ä¢ Ctrl+D: Deploy to Flowable
‚Ä¢ Ctrl+R: Start process instance
‚Ä¢ Ctrl+`: Toggle console
‚Ä¢ Delete: Remove selected element

üöÄ FLOWABLE INTEGRATION:
‚Ä¢ All elements are Flowable-certified
‚Ä¢ Real-time validation against BPMN 2.0 standard
‚Ä¢ One-click deployment to Flowable engine
‚Ä¢ Process instance management
‚Ä¢ Advanced simulation capabilities

üîß ELEMENT PROPERTIES:
‚Ä¢ User Tasks: Support assignee, candidate groups, forms
‚Ä¢ Gateways: Conditional expressions and Flowable expressions
‚Ä¢ Service Tasks: Java class delegation and expressions
‚Ä¢ Events: Message, timer, and error definitions

üí° TIPS:
‚Ä¢ Use meaningful names for better process readability
‚Ä¢ Set assignees or candidate groups for user tasks
‚Ä¢ Add documentation for complex elements
‚Ä¢ Validate before deploying to catch issues early
‚Ä¢ Use simulation to test process flow

For more help, visit the MACTA documentation or check the Flowable console output.
            `;
            
            alert(helpContent);
            addToConsole('‚ùì Help system accessed');
        }

        // Add help button to canvas toolbar
        document.querySelector('.canvas-toolbar').innerHTML += `
            <button class="canvas-btn" onclick="showHelp()">
                <span>‚ùì</span> Help
            </button>
        `;

        // Initialize with a welcome process template
        function createWelcomeTemplate() {
            if (processElements.length === 0) {
                const shouldCreate = confirm('Would you like to start with a sample MACTA process template?');
                if (shouldCreate) {
                    // Create a simple approval process
                    createElement('start', 100, 200);
                    createElement('user-task', 300, 200);
                    createElement('exclusive-gateway', 500, 200);
                    createElement('user-task', 700, 150);
                    createElement('service-task', 700, 250);
                    createElement('end', 900, 200);
                    
                    // Update properties for template
                    processElements[1].properties.name = 'Submit Request';
                    processElements[1].properties.assignee = 'requester';
                    processElements[2].properties.name = 'Approval Decision';
                    processElements[3].properties.name = 'Manager Review';
                    processElements[3].properties.candidateGroups = 'managers';
                    processElements[4].properties.name = 'Auto Notification';
                    
                    addToConsole('üìã Welcome template created');
                    addToConsole('üéØ Sample approval process ready for customization');
                }
            }
        }

        // Show template creation dialog after initial load
        setTimeout(createWelcomeTemplate, 2000);
    </script>
</body>
</html>