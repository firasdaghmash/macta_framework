<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced MACTA Modeling Module</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            border-bottom: 3px solid #f39c12;
            color: #f39c12;
            font-weight: bold;
        }

        .tab-content {
            padding: 30px;
            min-height: 600px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .modeling-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            height: 500px;
        }

        .process-canvas {
            border: 2px dashed #ddd;
            background: #fafafa;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .task-palette {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
        }

        .palette-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: move;
            text-align: center;
            transition: all 0.3s ease;
        }

        .palette-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .task-node {
            position: absolute;
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 10px;
            min-width: 120px;
            cursor: move;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .task-node.selected {
            border-color: #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
        }

        .resource-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .analysis-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .path-visualization {
            height: 300px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            overflow: auto;
        }

        .path-item {
            background: white;
            border-left: 4px solid #3498db;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 0 5px 5px 0;
        }

        .path-item.critical {
            border-left-color: #e74c3c;
        }

        .path-item.costly {
            border-left-color: #f39c12;
        }

        .path-item.resource-intensive {
            border-left-color: #9b59b6;
        }

        .simulation-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .arrival-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .animation-viewport {
            height: 400px;
            background: linear-gradient(45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(-45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f8f9fa 75%), 
                        linear-gradient(-45deg, transparent 75%, #f8f9fa 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .process-entity {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            transition: all 0.5s ease;
        }

        .metrics-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-message {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #27ae60;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Enhanced MACTA Modeling Module</h1>
            <p>Advanced Process Modeling with Resource Assignment & Analysis</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="modeling">üîß Process Modeling</button>
            <button class="nav-tab" data-tab="resources">üë• Resource Assignment</button>
            <button class="nav-tab" data-tab="simulation">üéÆ Simulation & Animation</button>
            <button class="nav-tab" data-tab="analysis">üìä Path Analysis</button>
        </div>

        <!-- Process Modeling Tab -->
        <div id="modeling" class="tab-pane active">
            <div class="tab-content">
                <h2>Process Designer</h2>
                <div class="status-message">
                    ‚úÖ JavaScript functions are now working properly! Click tabs above to test.
                </div>
                <div class="modeling-area">
                    <div class="process-canvas" id="processCanvas">
                        <div class="task-node" style="top: 50px; left: 50px;" data-task-id="start">
                            <strong>Start Process</strong>
                            <div>Duration: 0 min</div>
                        </div>
                        <div class="task-node selected" style="top: 150px; left: 200px;" data-task-id="task1">
                            <strong>Review Request</strong>
                            <div>Duration: 30 min</div>
                            <div>Resources: 1</div>
                        </div>
                    </div>
                    <div class="task-palette">
                        <h3>Task Components</h3>
                        <div class="palette-item" draggable="true">
                            üìã Manual Task
                        </div>
                        <div class="palette-item" draggable="true">
                            ü§ñ Automated Task
                        </div>
                        <div class="palette-item" draggable="true">
                            üë§ User Task
                        </div>
                        <div class="palette-item" draggable="true">
                            ‚úâÔ∏è Send Task
                        </div>
                        <div class="palette-item" draggable="true">
                            üì® Receive Task
                        </div>
                        <div class="palette-item" draggable="true">
                            üîÄ Gateway
                        </div>
                        <div class="palette-item" draggable="true">
                            ‚è∞ Timer Event
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resource Assignment Tab -->
        <div id="resources" class="tab-pane">
            <div class="tab-content">
                <h2>Resource Assignment for Selected Task</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div class="resource-form">
                        <h3>Task: Review Request</h3>
                        
                        <div class="form-group">
                            <label>Resource Type:</label>
                            <select id="resourceType">
                                <option value="human">Human Resource</option>
                                <option value="machine">Machine/Equipment</option>
                                <option value="hybrid">Hybrid (Human + Machine)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Duration (minutes):</label>
                            <input type="number" id="taskDuration" value="30" min="1">
                        </div>

                        <div class="form-group">
                            <label>Number of Resources:</label>
                            <input type="number" id="resourceCount" value="1" min="1">
                        </div>

                        <div class="form-group">
                            <label>Hourly Cost ($):</label>
                            <input type="number" id="hourlyCost" value="50" min="0" step="0.01">
                        </div>

                        <div class="form-group">
                            <label>Skill Level:</label>
                            <select id="skillLevel">
                                <option value="entry">Entry Level</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                                <option value="expert">Expert</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Task Complexity:</label>
                            <select id="taskComplexity">
                                <option value="simple">Simple</option>
                                <option value="moderate">Moderate</option>
                                <option value="complex">Complex</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>

                        <button class="btn btn-success" id="applyBtn">Apply Settings</button>
                        <button class="btn btn-warning" id="defaultBtn">Set as Default</button>
                    </div>

                    <div class="resource-form">
                        <h3>Default Resource Templates</h3>
                        
                        <div class="form-group">
                            <label>Template Name:</label>
                            <select id="resourceTemplate">
                                <option value="">Select Template</option>
                                <option value="analyst">Business Analyst</option>
                                <option value="developer">Software Developer</option>
                                <option value="manager">Project Manager</option>
                                <option value="automation">Automation System</option>
                            </select>
                        </div>

                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <h4>Current Task Calculation:</h4>
                            <div style="margin: 10px 0;">
                                <strong>Total Cost:</strong> $<span id="totalCost">25.00</span>
                            </div>
                            <div style="margin: 10px 0;">
                                <strong>Resource Utilization:</strong> <span id="utilization">100%</span>
                            </div>
                            <div style="margin: 10px 0;">
                                <strong>Estimated Queue Time:</strong> <span id="queueTime">5 min</span>
                            </div>
                        </div>

                        <h4>Arrival Rate Configuration</h4>
                        <div class="form-group">
                            <label>Arrival Rate (per hour):</label>
                            <input type="number" id="arrivalRate" value="2" min="0.1" step="0.1">
                        </div>

                        <div class="form-group">
                            <label>Process Type:</label>
                            <select id="processType">
                                <option value="standard">Standard Process</option>
                                <option value="priority">Priority Process</option>
                                <option value="batch">Batch Process</option>
                                <option value="adhoc">Ad-hoc Process</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simulation & Animation Tab -->
        <div id="simulation" class="tab-pane">
            <div class="tab-content">
                <h2>Process Simulation & Animation</h2>
                
                <div class="simulation-controls">
                    <h3>Simulation Controls</h3>
                    <div class="arrival-config">
                        <div class="form-group">
                            <label>Simulation Speed:</label>
                            <select id="simSpeed">
                                <option value="0.5">0.5x</option>
                                <option value="1" selected>1x</option>
                                <option value="2">2x</option>
                                <option value="5">5x</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Simulation Duration (hours):</label>
                            <input type="number" id="simDuration" value="8" min="1" max="24">
                        </div>
                        <div class="form-group">
                            <label>Entity Arrival Pattern:</label>
                            <select id="arrivalPattern">
                                <option value="regular">Regular Intervals</option>
                                <option value="random">Random (Poisson)</option>
                                <option value="burst">Burst Mode</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <button class="btn btn-success" id="startBtn">‚ñ∂Ô∏è Start</button>
                            <button class="btn btn-warning" id="pauseBtn">‚è∏Ô∏è Pause</button>
                            <button class="btn" id="resetBtn">üîÑ Reset</button>
                        </div>
                    </div>
                </div>

                <div class="animation-viewport" id="animationViewport">
                    <div style="position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px;">
                        <strong>Live Metrics:</strong><br>
                        Entities in System: <span id="entitiesCount">0</span><br>
                        Avg Wait Time: <span id="avgWaitTime">0</span> min<br>
                        Throughput: <span id="throughput">0</span>/hour
                    </div>
                </div>

                <div class="metrics-dashboard">
                    <div class="metric-card">
                        <div class="metric-value" id="processedCount">0</div>
                        <div>Entities Processed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgProcessTime">0</div>
                        <div>Avg Process Time (min)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="resourceEfficiency">0%</div>
                        <div>Resource Efficiency</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalCostSim">$0</div>
                        <div>Total Cost</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Path Analysis Tab -->
        <div id="analysis" class="tab-pane">
            <div class="tab-content">
                <h2>Advanced Path Analysis</h2>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h3>üî¥ Critical Path</h3>
                        <div class="path-visualization">
                            <div class="path-item critical">
                                <strong>Start ‚Üí Review Request</strong><br>
                                Duration: 30 min | Cost: $25<br>
                                Critical Factor: Longest duration
                            </div>
                            <div class="path-item critical">
                                <strong>Review Request ‚Üí Approval</strong><br>
                                Duration: 45 min | Cost: $60<br>
                                Critical Factor: Resource dependency
                            </div>
                            <div class="path-item critical">
                                <strong>Approval ‚Üí Complete</strong><br>
                                Duration: 15 min | Cost: $20<br>
                                Critical Factor: Final step
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: #ffebee; border-radius: 5px;">
                                <strong>Total Critical Path:</strong> 90 min | $105
                            </div>
                        </div>
                    </div>

                    <div class="analysis-card">
                        <h3>‚è±Ô∏è Most Time Consuming Path</h3>
                        <div class="path-visualization">
                            <div class="path-item">
                                <strong>Start ‚Üí Initial Review</strong><br>
                                Duration: 25 min | Resources: 1<br>
                                Time Factor: Setup overhead
                            </div>
                            <div class="path-item">
                                <strong>Initial Review ‚Üí Deep Analysis</strong><br>
                                Duration: 60 min | Resources: 2<br>
                                Time Factor: Complex analysis required
                            </div>
                            <div class="path-item">
                                <strong>Deep Analysis ‚Üí Final Approval</strong><br>
                                Duration: 30 min | Resources: 1<br>
                                Time Factor: Management review
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                                <strong>Total Time Path:</strong> 115 min
                            </div>
                        </div>
                    </div>

                    <div class="analysis-card">
                        <h3>üë• Most Human Resources Path</h3>
                        <div class="path-visualization">
                            <div class="path-item resource-intensive">
                                <strong>Collaborative Review</strong><br>
                                Duration: 40 min | Resources: 4<br>
                                Human Factor: Team meeting required
                            </div>
                            <div class="path-item resource-intensive">
                                <strong>Cross-Department Validation</strong><br>
                                Duration: 35 min | Resources: 3<br>
                                Human Factor: Multiple stakeholders
                            </div>
                            <div class="path-item resource-intensive">
                                <strong>Final Sign-off</strong><br>
                                Duration: 20 min | Resources: 2<br>
                                Human Factor: Executive approval
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: #f3e5f5; border-radius: 5px;">
                                <strong>Total Resources:</strong> 9 people | 95 min
                            </div>
                        </div>
                    </div>

                    <div class="analysis-card">
                        <h3>üí∞ Most Costly Path</h3>
                        <div class="path-visualization">
                            <div class="path-item costly">
                                <strong>Expert Consultation</strong><br>
                                Duration: 30 min | Cost: $150<br>
                                Cost Factor: Senior specialist rate
                            </div>
                            <div class="path-item costly">
                                <strong>External Audit</strong><br>
                                Duration: 45 min | Cost: $200<br>
                                Cost Factor: Third-party service
                            </div>
                            <div class="path-item costly">
                                <strong>Legal Review</strong><br>
                                Duration: 25 min | Cost: $125<br>
                                Cost Factor: Legal counsel
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: #fff3e0; border-radius: 5px;">
                                <strong>Total Cost Path:</strong> $475 | 100 min
                            </div>
                        </div>
                    </div>

                    <div class="analysis-card">
                        <h3>‚≠ê Ideal Path</h3>
                        <div class="path-visualization">
                            <div class="path-item">
                                <strong>Automated Initial Processing</strong><br>
                                Duration: 5 min | Cost: $2<br>
                                Ideal Factor: AI-powered
                            </div>
                            <div class="path-item">
                                <strong>Smart Routing</strong><br>
                                Duration: 2 min | Cost: $1<br>
                                Ideal Factor: Rule-based automation
                            </div>
                            <div class="path-item">
                                <strong>Quick Approval</strong><br>
                                Duration: 10 min | Cost: $15<br>
                                Ideal Factor: Pre-approved criteria
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 5px;">
                                <strong>Ideal Path:</strong> $18 | 17 min | 95% automation
                            </div>
                        </div>
                    </div>

                    <div class="analysis-card">
                        <h3>üîÑ Most Frequent Path</h3>
                        <div class="path-visualization">
                            <div class="path-item">
                                <strong>Standard Review Process</strong><br>
                                Frequency: 78% of cases<br>
                                Duration: 25 min | Cost: $30
                            </div>
                            <div class="path-item">
                                <strong>Manager Approval</strong><br>
                                Frequency: 65% of cases<br>
                                Duration: 15 min | Cost: $20
                            </div>
                            <div class="path-item">
                                <strong>Notification & Close</strong><br>
                                Frequency: 98% of cases<br>
                                Duration: 5 min | Cost: $3
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: #f0f4f8; border-radius: 5px;">
                                <strong>Most Common:</strong> $53 | 45 min | 70% frequency
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <button class="btn btn-success" id="reportBtn">üìä Generate Detailed Report</button>
                    <button class="btn btn-warning" id="exportBtn">üì§ Export Analysis</button>
                    <button class="btn" id="optimizeBtn">üöÄ Suggest Optimizations</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Define all variables first
        let currentTab = 'modeling';
        let simulationRunning = false;
        let simulationMetrics = { processed: 0, totalTime: 0, totalCost: 0 };

        // Tab switching function using event delegation
        function initTabSwitching() {
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active from all tabs and panes
                    navTabs.forEach(t => t.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    // Add active to clicked tab and corresponding pane
                    this.classList.add('active');
                    const targetPane = document.getElementById(targetTab);
                    if (targetPane) {
                        targetPane.classList.add('active');
                    }
                    
                    currentTab = targetTab;
                    console.log('Tab switched to:', targetTab);
                });
            });
        }

        // Resource management functions
        function applyResourceSettings() {
            const duration = parseFloat(document.getElementById('taskDuration').value) || 30;
            const cost = parseFloat(document.getElementById('hourlyCost').value) || 50;
            const resources = parseInt(document.getElementById('resourceCount').value) || 1;
            const arrivalRate = parseFloat(document.getElementById('arrivalRate').value) || 2;
            
            // Calculate total cost
            const totalCost = (cost * resources * duration / 60).toFixed(2);
            document.getElementById('totalCost').textContent = totalCost;

            // Calculate utilization
            const serviceRate = 60 / duration;
            const utilization = Math.min((arrivalRate / serviceRate * 100), 100).toFixed(0);
            document.getElementById('utilization').textContent = utilization + '%';

            // Calculate queue time
            const queueTime = utilization > 80 ? Math.round(duration * 0.3) : Math.round(duration * 0.1);
            document.getElementById('queueTime').textContent = queueTime + ' min';

            console.log('Resource settings applied:', { duration, cost, resources, totalCost });
            alert('Resource settings applied successfully!');
        }

        function loadTemplate() {
            const templateName = document.getElementById('resourceTemplate').value;
            const templates = {
                'analyst': { duration: 45, cost: 75, resources: 1, skillLevel: 'advanced', complexity: 'complex' },
                'developer': { duration: 120, cost: 85, resources: 1, skillLevel: 'expert', complexity: 'complex' },
                'manager': { duration: 30, cost: 100, resources: 1, skillLevel: 'expert', complexity: 'moderate' },
                'automation': { duration: 5, cost: 10, resources: 1, skillLevel: 'expert', complexity: 'simple' }
            };

            if (templates[templateName]) {
                const template = templates[templateName];
                document.getElementById('taskDuration').value = template.duration;
                document.getElementById('hourlyCost').value = template.cost;
                document.getElementById('resourceCount').value = template.resources;
                document.getElementById('skillLevel').value = template.skillLevel;
                document.getElementById('taskComplexity').value = template.complexity;
                
                applyResourceSettings();
                console.log('Template loaded:', templateName);
            }
        }

        // Simulation functions
        function startSimulation() {
            if (simulationRunning) return;
            
            simulationRunning = true;
            simulationMetrics = { processed: 0, totalTime: 0, totalCost: 0 };
            
            document.getElementById('startBtn').textContent = '‚è∏Ô∏è Running...';
            document.getElementById('startBtn').disabled = true;
            
            console.log('Simulation started');
            
            // Simple demo animation
            const viewport = document.getElementById('animationViewport');
            const interval = setInterval(() => {
                if (!simulationRunning) {
                    clearInterval(interval);
                    return;
                }
                
                // Create entity
                const entity = document.createElement('div');
                entity.className = 'process-entity';
                entity.style.left = '10px';
                entity.style.top = Math.random() * 350 + 20 + 'px';
                entity.style.backgroundColor = ['#3498db', '#e74c3c', '#f39c12', '#27ae60'][Math.floor(Math.random() * 4)];
                viewport.appendChild(entity);
                
                // Animate entity
                setTimeout(() => {
                    entity.style.left = '300px';
                }, 100);
                
                setTimeout(() => {
                    entity.remove();
                    simulationMetrics.processed++;
                    document.getElementById('processedCount').textContent = simulationMetrics.processed;
                    document.getElementById('entitiesCount').textContent = viewport.querySelectorAll('.process-entity').length;
                }, 2000);
                
            }, 3000);
        }

        function pauseSimulation() {
            simulationRunning = false;
            document.getElementById('startBtn').textContent = '‚ñ∂Ô∏è Start';
            document.getElementById('startBtn').disabled = false;
            console.log('Simulation paused');
        }

        function resetSimulation() {
            simulationRunning = false;
            simulationMetrics = { processed: 0, totalTime: 0, totalCost: 0 };
            
            // Clear viewport
            const viewport = document.getElementById('animationViewport');
            viewport.querySelectorAll('.process-entity').forEach(e => e.remove());
            
            // Reset UI
            document.getElementById('processedCount').textContent = '0';
            document.getElementById('entitiesCount').textContent = '0';
            document.getElementById('startBtn').textContent = '‚ñ∂Ô∏è Start';
            document.getElementById('startBtn').disabled = false;
            
            console.log('Simulation reset');
        }

        function generateReport() {
            const report = {
                timestamp: new Date().toLocaleString(),
                paths: {
                    critical: { duration: 90, cost: 105, resources: 3 },
                    timeConsuming: { duration: 115, cost: 85, resources: 6 },
                    resourceIntensive: { duration: 95, cost: 180, resources: 9 },
                    costly: { duration: 100, cost: 475, resources: 4 },
                    ideal: { duration: 17, cost: 18, resources: 1 },
                    frequent: { duration: 45, cost: 53, resources: 2, frequency: 70 }
                }
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'macta_analysis_report.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('Analysis report generated and downloaded!');
        }

        function exportAnalysis() {
            const csvData = [
                ['Path Type', 'Duration (min)', 'Cost ($)', 'Resources', 'Frequency (%)'],
                ['Critical Path', '90', '105', '3', '100'],
                ['Time Consuming', '115', '85', '6', '85'],
                ['Resource Intensive', '95', '180', '9', '60'],
                ['Most Costly', '100', '475', '4', '25'],
                ['Ideal Path', '17', '18', '1', '5'],
                ['Most Frequent', '45', '53', '2', '70']
            ];
            
            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'macta_path_analysis.csv';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('Path analysis exported to CSV!');
        }

        function showOptimizations() {
            const optimizations = [
                {
                    title: 'Automation Opportunity',
                    description: 'Automate 40% of routine review tasks',
                    impact: 'Reduce time by 35%, cost by 60%',
                    effort: 'Medium'
                },
                {
                    title: 'Parallel Processing',
                    description: 'Enable parallel execution for independent tasks',
                    impact: 'Reduce time by 50%, increase resource usage by 20%',
                    effort: 'High'
                },
                {
                    title: 'Skill-Based Routing',
                    description: 'Route tasks based on complexity and skill match',
                    impact: 'Reduce time by 25%, improve quality by 30%',
                    effort: 'Low'
                }
            ];
            
            let message = 'üöÄ Process Optimization Recommendations:\n\n';
            optimizations.forEach((opt, i) => {
                message += `${i + 1}. ${opt.title}\n`;
                message += `   ${opt.description}\n`;
                message += `   Impact: ${opt.impact}\n`;
                message += `   Effort: ${opt.effort}\n\n`;
            });
            
            alert(message);
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Enhanced MACTA Modeling Module initialized');
            
            // Initialize tab switching
            initTabSwitching();
            
            // Initialize button event listeners
            document.getElementById('applyBtn').addEventListener('click', applyResourceSettings);
            document.getElementById('defaultBtn').addEventListener('click', function() {
                const template = {
                    duration: document.getElementById('taskDuration').value,
                    cost: document.getElementById('hourlyCost').value,
                    resources: document.getElementById('resourceCount').value,
                    skillLevel: document.getElementById('skillLevel').value,
                    complexity: document.getElementById('taskComplexity').value
                };
                localStorage.setItem('defaultResourceTemplate', JSON.stringify(template));
                alert('Settings saved as default template!');
            });
            
            document.getElementById('resourceTemplate').addEventListener('change', loadTemplate);
            
            // Simulation controls
            document.getElementById('startBtn').addEventListener('click', startSimulation);
            document.getElementById('pauseBtn').addEventListener('click', pauseSimulation);
            document.getElementById('resetBtn').addEventListener('click', resetSimulation);
            
            // Analysis controls
            document.getElementById('reportBtn').addEventListener('click', generateReport);
            document.getElementById('exportBtn').addEventListener('click', exportAnalysis);
            document.getElementById('optimizeBtn').addEventListener('click', showOptimizations);
            
            // Task node selection
            document.getElementById('processCanvas').addEventListener('click', function(e) {
                if (e.target.classList.contains('task-node')) {
                    document.querySelectorAll('.task-node').forEach(node => {
                        node.classList.remove('selected');
                    });
                    e.target.classList.add('selected');
                    console.log('Task selected:', e.target.dataset.taskId);
                }
            });
            
            // Initial calculation
            applyResourceSettings();
            
            console.log('‚úÖ All event listeners attached successfully!');
        });
    </script>
</body>
</html>