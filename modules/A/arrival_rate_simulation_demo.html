<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MACTA - Enhanced Arrival Rate Simulation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .simulation-card { 
            border-left: 4px solid #28a745; 
            transition: all 0.3s ease;
        }
        .simulation-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .metric-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white;
        }
        .recommendation-card {
            border-left: 4px solid #ffc107;
        }
        .bottleneck-high { border-left-color: #dc3545; }
        .bottleneck-medium { border-left-color: #fd7e14; }
        .bottleneck-low { border-left-color: #28a745; }
        .header-gradient {
            background: linear-gradient(135deg, #ee5a52 0%, #ff6b6b 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Header -->
    <div class="header-gradient">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-1">ðŸš€ Enhanced Arrival Rate Simulation</h1>
                    <p class="mb-0 fs-5">Transform from "single case analysis" to "realistic business load simulation"</p>
                </div>
                <div class="col-md-4 text-end">
                    <nav class="bg-white bg-opacity-25 p-2 rounded">
                        <a href="../../index.php" class="text-white text-decoration-none">MACTA Framework</a> > 
                        <a href="index.php" class="text-white text-decoration-none">Analysis</a> > 
                        <span>Arrival Rate Simulation</span>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-4">
        <!-- Configuration Panel -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ðŸ”§ Arrival Rate Configuration</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Business Scenario</label>
                                <select class="form-select" id="configType">
                                    <option value="insurance_claims">Insurance Claims Processing</option>
                                    <option value="customer_service">Customer Service Calls</option>
                                    <option value="order_processing">Order Processing (Batch)</option>
                                    <option value="custom">Custom Configuration</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Simulation Duration</label>
                                <select class="form-select" id="simulationHours">
                                    <option value="8">8 Hours (Single Shift)</option>
                                    <option value="24" selected>24 Hours (Full Day)</option>
                                    <option value="168">168 Hours (Full Week)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Arrival Rate (per hour)</label>
                                <input type="number" class="form-control" id="arrivalRate" value="4.2" step="0.1">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">SLA Target (minutes)</label>
                                <input type="number" class="form-control" id="slaTarget" value="120">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <button class="btn btn-primary btn-lg" onclick="runSimulation()">
                                    <i class="fas fa-play"></i> Run Enhanced Simulation
                                </button>
                                <button class="btn btn-outline-secondary ms-2" onclick="resetSimulation()">
                                    <i class="fas fa-refresh"></i> Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Dashboard -->
        <div class="row" id="resultsPanel" style="display: none;">
            <!-- Key Metrics -->
            <div class="col-12 mb-4">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <h3 class="mb-0" id="totalCases">-</h3>
                                <p class="mb-0">Total Cases</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <h3 class="mb-0" id="avgWaitTime">-</h3>
                                <p class="mb-0">Avg Wait Time (min)</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <h3 class="mb-0" id="slaCompliance">-</h3>
                                <p class="mb-0">SLA Compliance (%)</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <h3 class="mb-0" id="maxQueueLength">-</h3>
                                <p class="mb-0">Max Queue Length</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="col-md-6 mb-4">
                <div class="card simulation-card">
                    <div class="card-header">
                        <h5 class="mb-0">ðŸ“Š Queue Length Over Time</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="queueChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card simulation-card">
                    <div class="card-header">
                        <h5 class="mb-0">âš¡ Resource Utilization</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="utilizationChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card simulation-card">
                    <div class="card-header">
                        <h5 class="mb-0">ðŸ“ˆ Arrival Pattern Analysis</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="arrivalChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card simulation-card">
                    <div class="card-header">
                        <h5 class="mb-0">ðŸŽ¯ SLA Performance</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="slaChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Bottlenecks and Recommendations -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ðŸš¨ Identified Bottlenecks</h5>
                    </div>
                    <div class="card-body" id="bottlenecksContainer">
                        <p class="text-muted">Run simulation to identify bottlenecks...</p>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ðŸ’¡ Business Recommendations</h5>
                    </div>
                    <div class="card-body" id="recommendationsContainer">
                        <p class="text-muted">Run simulation to get recommendations...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="row" id="loadingPanel" style="display: none;">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Running arrival rate simulation...</p>
                <p class="text-muted">Analyzing queue dynamics, resource utilization, and capacity planning</p>
            </div>
        </div>

        <!-- Demo Info -->
        <div class="row" id="demoInfo">
            <div class="col-12">
                <div class="alert alert-info">
                    <h5>ðŸŽ¯ Demo Mode</h5>
                    <p class="mb-0">This is a demonstration of the Enhanced Arrival Rate Simulation. Click "Run Enhanced Simulation" to see realistic business scenarios with queue management, capacity planning, and performance optimization insights.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentResults = null;

        function runSimulation() {
            // Hide demo info and show loading
            document.getElementById('demoInfo').style.display = 'none';
            document.getElementById('loadingPanel').style.display = 'block';
            document.getElementById('resultsPanel').style.display = 'none';

            // Get configuration values
            const configType = document.getElementById('configType').value;
            const simulationHours = parseInt(document.getElementById('simulationHours').value);
            const arrivalRate = parseFloat(document.getElementById('arrivalRate').value);
            const slaTarget = parseInt(document.getElementById('slaTarget').value);

            // Simulate processing time
            setTimeout(() => {
                const results = generateSimulationResults(configType, simulationHours, arrivalRate, slaTarget);
                displayResults(results);
                document.getElementById('loadingPanel').style.display = 'none';
                document.getElementById('resultsPanel').style.display = 'block';
            }, 3000);
        }

        function resetSimulation() {
            document.getElementById('demoInfo').style.display = 'block';
            document.getElementById('loadingPanel').style.display = 'none';
            document.getElementById('resultsPanel').style.display = 'none';
        }

        function generateSimulationResults(configType, hours, arrivalRate, slaTarget) {
            // Generate realistic simulation data
            const totalCases = Math.round(arrivalRate * hours * (0.8 + Math.random() * 0.4));
            const avgWaitTime = Math.round(15 + Math.random() * 45);
            const slaCompliance = Math.round(75 + Math.random() * 20);
            const maxQueueLength = Math.round(5 + Math.random() * 15);

            // Generate hourly data
            const hourlyData = [];
            for (let i = 0; i < Math.min(24, hours); i++) {
                const baseArrivals = arrivalRate * (0.7 + Math.random() * 0.6);
                const peakFactor = getPeakFactor(i, configType);
                
                hourlyData.push({
                    hour: i,
                    arrivals: Math.round(baseArrivals * peakFactor),
                    queue_length: Math.round(Math.random() * maxQueueLength),
                    cases_completed: Math.round(baseArrivals * 0.9),
                    utilization: Math.round(60 + Math.random() * 35)
                });
            }

            // Generate bottlenecks and recommendations
            const bottlenecks = generateBottlenecks(totalCases, avgWaitTime, slaCompliance, maxQueueLength);
            const recommendations = generateRecommendations(bottlenecks, configType);

            return {
                totalCases,
                avgWaitTime,
                slaCompliance,
                maxQueueLength,
                hourlyData,
                bottlenecks,
                recommendations,
                configType,
                slaTarget
            };
        }

        function getPeakFactor(hour, configType) {
            const patterns = {
                insurance_claims: [0.3, 0.2, 0.2, 0.3, 0.4, 0.6, 0.8, 1.0, 1.5, 1.8, 1.6, 1.4, 1.2, 1.3, 1.4, 1.2, 1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.2, 0.2],
                customer_service: [0.1, 0.1, 0.1, 0.2, 0.3, 0.5, 0.8, 1.2, 2.0, 2.2, 1.8, 1.5, 1.6, 1.4, 1.2, 1.0, 0.8, 0.6, 0.4, 0.3, 0.2, 0.1, 0.1, 0.1],
                order_processing: [0.5, 0.3, 0.2, 0.2, 0.3, 0.5, 0.7, 1.0, 1.2, 1.5, 1.8, 2.0, 1.5, 1.8, 2.2, 1.8, 1.5, 1.2, 1.0, 0.8, 0.6, 0.5, 0.4, 0.4]
            };
            
            return patterns[configType] ? patterns[configType][hour] || 1.0 : 1.0;
        }

        function generateBottlenecks(totalCases, avgWaitTime, slaCompliance, maxQueueLength) {
            const bottlenecks = [];
            
            if (maxQueueLength > 10) {
                bottlenecks.push({
                    type: 'capacity',
                    severity: 'high',
                    description: 'System capacity insufficient for arrival rate',
                    metric: `Max queue length: ${maxQueueLength}`
                });
            }
            
            if (slaCompliance < 85) {
                bottlenecks.push({
                    type: 'process',
                    severity: 'medium',
                    description: 'Process taking too long to complete cases',
                    metric: `SLA compliance: ${slaCompliance}%`
                });
            }
            
            if (avgWaitTime > 30) {
                bottlenecks.push({
                    type: 'resource',
                    severity: avgWaitTime > 60 ? 'high' : 'medium',
                    description: 'Insufficient resources causing long wait times',
                    metric: `Average wait time: ${avgWaitTime} minutes`
                });
            }
            
            return bottlenecks;
        }

        function generateRecommendations(bottlenecks, configType) {
            const recommendations = [];
            
            bottlenecks.forEach(bottleneck => {
                switch (bottleneck.type) {
                    case 'capacity':
                        recommendations.push({
                            type: 'capacity',
                            priority: 'high',
                            issue: bottleneck.description,
                            recommendation: 'Add 2-3 additional resources or implement automated processing',
                            impact: 'Reduce queue length by 60-70%'
                        });
                        break;
                    case 'process':
                        recommendations.push({
                            type: 'process',
                            priority: 'medium',
                            issue: bottleneck.description,
                            recommendation: 'Optimize process steps or implement parallel processing',
                            impact: 'Improve SLA compliance to 90%+'
                        });
                        break;
                    case 'resource':
                        recommendations.push({
                            type: 'resource',
                            priority: 'high',
                            issue: bottleneck.description,
                            recommendation: 'Increase staffing during peak hours or cross-train team members',
                            impact: 'Reduce wait times by 40-50%'
                        });
                        break;
                }
            });
            
            if (recommendations.length === 0) {
                recommendations.push({
                    type: 'optimization',
                    priority: 'low',
                    issue: 'System performing well',
                    recommendation: 'Consider minor optimizations for cost reduction',
                    impact: 'Potential 5-10% efficiency improvement'
                });
            }
            
            return recommendations;
        }

        function displayResults(results) {
            // Update key metrics
            document.getElementById('totalCases').textContent = results.totalCases;
            document.getElementById('avgWaitTime').textContent = results.avgWaitTime;
            document.getElementById('slaCompliance').textContent = results.slaCompliance;
            document.getElementById('maxQueueLength').textContent = results.maxQueueLength;

            // Create charts
            createQueueChart(results.hourlyData);
            createUtilizationChart(results.hourlyData);
            createArrivalChart(results.hourlyData);
            createSLAChart(results.slaCompliance, results.slaTarget);

            // Display bottlenecks and recommendations
            displayBottlenecks(results.bottlenecks);
            displayRecommendations(results.recommendations);
        }

        function createQueueChart(hourlyData) {
            const ctx = document.getElementById('queueChart').getContext('2d');
            const hours = hourlyData.map(d => `Hour ${d.hour}`);
            const queueLengths = hourlyData.map(d => d.queue_length);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Queue Length',
                        data: queueLengths,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cases in Queue'
                            }
                        }
                    }
                }
            });
        }

        function createUtilizationChart(hourlyData) {
            const ctx = document.getElementById('utilizationChart').getContext('2d');
            const hours = hourlyData.map(d => `Hour ${d.hour}`);
            const utilization = hourlyData.map(d => d.utilization);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Resource Utilization %',
                        data: utilization,
                        backgroundColor: utilization.map(u => 
                            u > 90 ? '#dc3545' : 
                            u > 70 ? '#ffc107' : '#28a745'
                        )
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Utilization %'
                            }
                        }
                    }
                }
            });
        }

        function createArrivalChart(hourlyData) {
            const ctx = document.getElementById('arrivalChart').getContext('2d');
            const hours = hourlyData.map(d => `Hour ${d.hour}`);
            const arrivals = hourlyData.map(d => d.arrivals);
            const completed = hourlyData.map(d => d.cases_completed);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Arrivals',
                        data: arrivals,
                        borderColor: '#fd7e14',
                        backgroundColor: 'rgba(253, 126, 20, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Completed',
                        data: completed,
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cases per Hour'
                            }
                        }
                    }
                }
            });
        }

        function createSLAChart(compliance, target) {
            const ctx = document.getElementById('slaChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Met SLA', 'Missed SLA'],
                    datasets: [{
                        data: [compliance, 100 - compliance],
                        backgroundColor: ['#28a745', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function displayBottlenecks(bottlenecks) {
            const container = document.getElementById('bottlenecksContainer');
            
            if (bottlenecks.length === 0) {
                container.innerHTML = '<p class="text-success">âœ… No major bottlenecks identified!</p>';
                return;
            }

            let html = '';
            bottlenecks.forEach(bottleneck => {
                const severityClass = `bottleneck-${bottleneck.severity}`;
                html += `
                    <div class="card mb-2 ${severityClass}">
                        <div class="card-body py-2">
                            <h6 class="mb-1">${bottleneck.type.toUpperCase()} - ${bottleneck.severity.toUpperCase()}</h6>
                            <p class="mb-1">${bottleneck.description}</p>
                            <small class="text-muted">${bottleneck.metric}</small>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendationsContainer');
            
            if (recommendations.length === 0) {
                container.innerHTML = '<p class="text-success">âœ… System performing optimally!</p>';
                return;
            }

            let html = '';
            recommendations.forEach(rec => {
                const priorityBadge = rec.priority === 'high' ? 'danger' : 
                                    rec.priority === 'medium' ? 'warning' : 'success';
                html += `
                    <div class="card recommendation-card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <h6 class="mb-1">${rec.type.toUpperCase()}</h6>
                                <span class="badge bg-${priorityBadge}">${rec.priority}</span>
                            </div>
                            <p class="mb-2"><strong>Issue:</strong> ${rec.issue}</p>
                            <p class="mb-2"><strong>Recommendation:</strong> ${rec.recommendation}</p>
                            <p class="mb-0 text-success"><strong>Expected Impact:</strong> ${rec.impact}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-adjust arrival rate based on scenario
            document.getElementById('configType').addEventListener('change', function() {
                const rates = {
                    insurance_claims: 4.2,
                    customer_service: 7.5,
                    order_processing: 2.8,
                    custom: 4.2
                };
                document.getElementById('arrivalRate').value = rates[this.value] || 4.2;
            });
        });
    </script>
</body>
</html>